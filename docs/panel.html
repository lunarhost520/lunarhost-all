<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>LunarHost Server Panel</title>
  <style>
    body { font-family: 'Inter', Arial, sans-serif; background: #355389; color: #fff;}
    .container { max-width: 900px; margin: 48px auto; background: #3c5d8e; border-radius: 12px; padding: 32px;}
    h2 { margin-bottom: 18px;}
    .buttons { margin-bottom: 22px;}
    button { background: #ffa600; color: #fff; border: none; border-radius: 9px; padding: 8px 26px; font-size: 1.1em; margin-right: 18px; cursor: pointer;}
    button:hover { background: #ffb733;}
    .status { margin-bottom: 16px;}
    #console { background: #23292e; font-family: monospace; color: #b5e2ff; border-radius: 6px; padding: 18px; min-height: 260px; max-height: 380px; overflow-y: scroll;}
    .files { margin-top: 22px;}
  </style>
</head>
<body>
  <div class="container">
    <h2>Server Panel: <span id="serverName"></span></h2>
    <div class="status">
      Status: <span id="status">Loading...</span>
    </div>
    <div class="buttons">
      <button onclick="startServer()">Start</button>
      <button onclick="stopServer()">Stop</button>
      <button onclick="restartServer()">Restart</button>
    </div>
    <h3>Console</h3>
    <div id="console">Connecting...</div>
    <div class="files">
      <h3>File Manager</h3>
      <input type="file" id="uploadFile" />
      <button onclick="uploadFile()">Upload</button>
      <ul id="fileList"></ul>
    </div>
  </div>
  <script>
    // ---- JS for fetching status, logs, and managing files ----
    const urlParams = new URLSearchParams(window.location.search);
    const serverName = urlParams.get('server');
    document.getElementById('serverName').textContent = serverName;
    // Poll for status and logs
    async function fetchStatusAndLogs() {
      const statusResp = await fetch(`/api/status?server=${encodeURIComponent(serverName)}`);
      const statusData = await statusResp.json();
      document.getElementById('status').textContent = statusData.status;
      const logResp = await fetch(`/api/console?server=${encodeURIComponent(serverName)}`);
      const logText = await logResp.text();
      document.getElementById('console').textContent = logText;
    }
    setInterval(fetchStatusAndLogs, 2500);
    // File management
    async function uploadFile() {
      const fileInput = document.getElementById('uploadFile');
      const file = fileInput.files[0];
      if (!file) return alert("No file selected!");
      const formData = new FormData();
      formData.append("file", file);
      await fetch(`/api/upload?server=${encodeURIComponent(serverName)}`, { method: "POST", body: formData });
      listFiles();
    }
    async function listFiles() {
      const resp = await fetch(`/api/files?server=${encodeURIComponent(serverName)}`);
      const files = await resp.json();
      const ul = document.getElementById('fileList');
      ul.innerHTML = "";
      files.forEach(file => {
        const li = document.createElement('li');
        li.textContent = file;
        const dl = document.createElement('a');
        dl.textContent = "Download";
        dl.href = `/api/download?server=${encodeURIComponent(serverName)}&file=${encodeURIComponent(file)}`;
        dl.style.marginLeft = "14px";
        li.appendChild(dl);
        ul.appendChild(li);
      });
    }
    listFiles();
    // Server controls
    async function startServer() {await fetch(`/api/start?server=${encodeURIComponent(serverName)}`);}
    async function stopServer() {await fetch(`/api/stop?server=${encodeURIComponent(serverName)}`);}
    async function restartServer() {await fetch(`/api/restart?server=${encodeURIComponent(serverName)}`);}
  </script>
</body>
</html>
